---
#title: \vspace{8cm} \LARGE{Sudan Micronutrient Survey Indicators Definition}
title: Sudan National Micronutrient Survey Indicators Definition
subtitle: ""
author: "Mark Myatt and Ernest Guevarra"
date: "13 May 2020" #'`r format(Sys.Date(), "%d %B %Y")`'
fontsize: 12pt
geometry: margin=2cm
documentclass: article
classoption: a4paper
bibliography: micronutrient.bib
link-citations: TRUE
links-as-notes: FALSE
colorlinks: TRUE
linkcolor: blue
citecolor: blue
urlcolor: blue
lot: false
lof: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      warning = FALSE,
                      message = FALSE)

knitr::knit_hooks$set(document = function(x) {
  sub('\\usepackage[]{color}', '\\usepackage{xcolor}', x, fixed = TRUE)
  }
)

if(!require(rgdal)) install.packages("rgdal")
if(!require(rgeos)) install.packages("rgeos")
if(!require(raster)) install.packages("raster")
if(!require(maps)) install.packages("maps")
if(!require(knitr)) install.packages("knitr")
if(!require(kableExtra)) install.packages("kableExtra")
if(!require(magrittr)) install.packages("magrittr")
if(!require(ggplot2)) install.packages("ggplot2")
if(!require(ggmap)) install.packages("ggmap")
if(!require(stringr)) install.packages("stringr")
if(!require(remotes)) install.packages("remotes")
if(!require(openxlsx)) install.packages("openxlsx")
if(!require(RColorBrewer)) install.packages("RColorBrewer")

if(!require(gadmr)) install_github("spatialworks/gadmr")
if(!require(spatialsampler)) install_github("spatialworks/spatialsampler")
if(!require(sudan)) install_github("spatialworks/sudan")

if(!require(drlib)) install_github("dgrtwo/drlib")

themeSettings <- theme_bw() +
  theme(panel.border = element_rect(colour = "gray50",
                                    size = 0.5),
        panel.grid.major = element_line(linetype = 1,
                                        size = 0.1,
                                        colour = "gray90"),
        panel.grid.minor = element_line(linetype = 0),
        strip.background = element_rect(colour = "gray50",
                                        fill = "gray70"),
        strip.text = element_text(colour = "white", size = 16),
        legend.text = element_text(size = 16),
        legend.key = element_rect(linetype = 0),
        legend.key.size = unit(0.5, "cm"),
        legend.position = "top",
        axis.title = element_text(size = 16),
        axis.text.x = element_text(size = 14),
        axis.text.y = element_text(size = 14),
        axis.ticks = element_line(colour = "gray50", size = 0.5))

## Micronutrient survey dataset
mnData1 <- read.xlsx(xlsxFile = "data/mnData_master_Sudan_V11.xlsx")
mnData2 <- read.xlsx(xlsxFile = "data/mnData_master_Sudan_V12.xlsx")

## S3M II data
psuData <- read.csv("data/updatedPSU.csv", stringsAsFactors = FALSE)
locNames <- read.csv("data/locNames.csv", stringsAsFactors = FALSE)

## Maps
sudan02 <- readOGR(dsn = "data/locality/", layer = "sudan02")
sudanAlt <- raster(x = "data/srtm/SDN_alt.vrt")
```

\newpage

# Background

To aid the analysis of the Sudan National Micronutrient Survey 2017-2018 data, appropriate indicators needed to be defined. The only documentation of indicators to be assessed from the survey was the last version of the S3M-II indicators list dated 16 November 2018. However, this document does not clearly define the indicators with no cut-off values provided. As such, indicator definitions were made based on a rapid literature review including micronutrient survey reports done elsewhere and reflected upon based actual available data from the survey itself to update the indicator definitions. This document presents these definitions.

# Haemoglobin

In the main S3M-II survey, we defined multiple indicators based on Hb data. These indicators represented the different severities of anaemia by different respondent groupings. Classification into these severity categories was based on Hb level cut-offs defined by WHO [@WorldHealthOrganization:2007tx;@WorldHealthOrganization:2011ut] as follows:

```{r hb1, echo = FALSE, eval = TRUE}
Population <- c("Children 6-59 months of age",
                "Children 5-11 years of age",
                "Children 12-14 years of age",
                "Non-pregnant women\n(15 years and above)",
                "Pregnant women",
                "Men\n(15 years and above)")

Mild <- c("100 - 109", "110 - 114", "110 - 119", "110 - 119", "100 - 109", "110 - 129")

Moderate <- c("70 - 99", "80 - 109", "80 - 109", "80 - 109", "70 - 99", "80 - 109")

Severe <- c("< 70", "< 80", "< 80", "< 80", "< 70", "< 80")

tab <- data.frame(Population, Mild, Moderate, Severe, stringsAsFactors = FALSE)

knitr::kable(x = tab,
             booktabs = TRUE,
             caption = "Hb levels to diagnose anaemia at sea level in grams per litre (g/L)",
             row.names = FALSE,
             format = "latex") %>%
  kableExtra::kable_styling(latex_options = c("HOLD_position", "striped")) %>%
  kableExtra::row_spec(row = 0, bold = TRUE)
```

For the Sudan S3M-II main survey, no data was collected for children 5-17 years of age and for adult men 15 years of age and above so the indicator for this age group was not calculated and reported. When categorising respondents based on the above cut-offs in the main S3M-II survey, no adjustments to Hb were done based on altitude and for smoking history as recommended by WHO [@WorldHealthOrganization:2007tx;@WorldHealthOrganization:2011ut].

We propose to analyse the Sudan National Micronutrient Survey data using the same indicator definitions used in the Sudan S3M-II main survey. We also propose to adjust Hb based on altitude of the PSU from where the data was collected. Altitude data will be gathered from publicly available elevation model data (such as the Shuttle Radar Topography Mission or SRTM data that is available freely through various outlets for Sudan) if no altitude data can be provided by UNICEF. Map below shows elevation for Sudan based on publicly available SRTM data [@cgiar:2020].

```{r elevation1, echo = FALSE, eval = TRUE, fig.cap = "Shuttle Radar Topography Mission (SRTM) 90m Digital Elevation Model (DEM) for Sudan overlaid with the Sudan National Micronutrient survey primary sampling unit locations", fig.width = 10, fig.height = 10, fig.align = "center", fig.pos = "H"}
mnData_coords <- merge(psuData[ , c("psu", "longitude", "latitude")], mnData2, by = "psu")

sudanAlt_subset <- intersect(sudanAlt, sudan01)
sudanAlt_subset <- mask(sudanAlt_subset, sudan01)

plot(sudanAlt_subset, axes = FALSE)
plot(sudan01, add = TRUE)
points(x = mnData_coords[ , c("longitude", "latitude")], pch = 20, cex = 0.5, col = "darkblue")
```

With this data, we are able to extract elevation data for each of the PSUs in the Sudan Micronutrient Survey dataset.

\newpage

```{r elevation2, echo = FALSE, eval = TRUE}
mnData_spdf <- SpatialPointsDataFrame(coords = mnData_coords[ , c("longitude", "latitude")], 
                                      data = mnData_coords,
                                      proj4string = CRS(proj4string(sudan01)))

mnData_elevation <- data.frame(mnData_coords, altitude = extract(sudanAlt_subset, mnData_spdf))

knitr::kable(x = head(mnData_elevation[ , c("psu", "state", "locality", "sex", 
                                            "hb", "altitude")], 40),
             booktabs = TRUE,
             caption = "Sudan National Micronutrient Survey dataset with altitude extracted from SRTM 90m DEM",
             row.names = FALSE,
             format = "latex") %>%
  #kableExtra::landscape() %>%
  kableExtra::kable_styling(latex_options = c("HOLD_position", "striped")) %>%
  kableExtra::row_spec(row = 0, bold = TRUE)
```

Adjustments to measured Hb based on altitude will be done based on the following [@WorldHealthOrganization:2011ut]:

```{r hb2, echo = FALSE, eval = TRUE}
col1 <- c("< 1000", "1000", "1500", "2000", "2500", "3000", "3500", "4000", "4500")
col2 <- c(0, -2, -5, -8, -13, -19, -27, -35, -45)

tab <- data.frame(col1, col2, stringsAsFactors = FALSE)

knitr::kable(x = tab,
             booktabs = TRUE,
             caption = "Altitude adjustments to measured haemoglobin concentrations",
             col.names = linebreak(x = c("Altitude\n(metres above\nsea level)", 
                                         "Measured\nhaemoglobin\nadjustment\n(g/L)"), 
                                   align = "c"),
             row.names = FALSE,
             escape = FALSE,
             format = "latex") %>%
  kableExtra::kable_styling(latex_options = c("HOLD_position", "striped")) %>%
  kableExtra::row_spec(row = 0, bold = TRUE)
```

# Serum ferritin

Normal serum ferritin levels range from 12 µg/L to 150 µg/L. Following are the cut-offs for serum ferritin concentration that indicate either iron depletion or iron overload [@WorldHealthOrganization:2007tx; @Gorstein:2007wn; @Wegmuller:2020bw; @WorldHealthOrganization:2011ue].

```{r ferritin, echo = FALSE, eval = TRUE}
col1 <- c("Depleted iron stores", "Depleted iron stores in the presence of infection", "Severe risk of iron overload (adults)")
col2 <- c("< 12", "< 30", "-")
col3 <- c("< 12", "< 30", "-")
col4 <- c("< 15", "-", "> 200")
col5 <- c("< 15", "-", "> 150")

tab <- data.frame(col1, col2, col3, col4, col5, stringsAsFactors = FALSE)

knitr::kable(x = tab,
             booktabs = TRUE,
             caption = "Relative extent of iron stores on the basis of serum ferritin concentration (µg/L)",
             col.names = c("", "Male", "Female", "Male", "Female"),
             row.names = FALSE,
             escape = FALSE,
             format = "latex") %>%
  kableExtra::kable_styling(latex_options = c("HOLD_position", "striped", "scale_down")) %>%
  kableExtra::add_header_above(header = c(" " = 1, 
                                          "Less than 5 years" = 2, 
                                          "5 years or older" = 2),
                               align = "c", bold = TRUE) %>%
  kableExtra::add_header_above(header = c(" " = 1, 
                                          "Serum ferritin (µg/L)" = 4),
                               align = "c", bold = TRUE) %>%
  kableExtra::column_spec(column = 1, bold = TRUE) %>%
  kableExtra::row_spec(row = 0, bold = TRUE, align = "c")
```

Serum ferritin will be used to assess iron deficiency for children less than 5 and for any other individual above 5 years old. For children less than 5 years old, a cut-off for serum ferritin value of < 12 $\mu/L$ indicates iron deficiency while for those older than 5 years old, a cut-off of < 15 $\mu/L$ is used.

However, it has been recommended that serum ferritin values be adjusted based on inflammation status ideally using both of the acute phase proteins - C-reactive protein (CRP) and $\alpha_1$-acid glycoprotein (AGP) to yield the most unbiased estimates of iron deficiency. However, the Sudan Micronutrient Survey only assessed CRP in the samples. The recommended adjustments when only one of the active phase proteins is available is to use an appropriate multiplier to the serum ferritin value depending on inflammation status of the respondent as described below:

```{r inflammation, echo = FALSE, eval = TRUE}
col1 <- c("CRP", "AGP")
col2 <- c(">5 mg/L", ">1 g/L")

tab <- data.frame(col1, col2, stringsAsFactors = FALSE)

knitr::kable(x = tab,
             booktabs = TRUE,
             caption = "Cut-offs to determine inflammation",
             col.names = c("Active Phase Protein", "Cut-off"),
             row.names = FALSE,
             format = "latex") %>%
  kableExtra::kable_styling(latex_options = c("HOLD_position", "striped")) %>%
  kableExtra::row_spec(row = 0, bold = TRUE)
```

If a respondent is classified as being in an active inflammation process, then serum ferritin is adjusted accordingly. If inflammation is assessed using CRP only, the serum ferritin is adjusted by 0.65 [@Thurnham:2010he].

# Calcium

The range of normal values for serum calcium is age-dependent as shown below [@Lietman:2010iu]:

```{r calcium, echo = FALSE, eval = TRUE}
col0 <- c(rep("Infants", 2), "Children", rep("Men", 3), rep("Women", 3))
col1 <- c("0-3 months", "1-5 years", "6-12 years", 
          "20 years", "50 years", "70 years", 
          "20 years", "50 years", "70 years")

col2 <- c("8.8 - 11.3", "9.4 - 10.8", "9.4 - 10.3", "9.1 - 10.2", 
          "8.9 - 10.0", "8.8 - 9.9", 
          "8.8 - 10.0", "8.8 - 10.0", "8.8 - 10.0")

tab <- data.frame(col0, col1, col2, stringsAsFactors = FALSE)

knitr::kable(x = tab,
             booktabs = TRUE,
             caption = "Representative normal values for age for concentration of serum total calcium",
             col.names = linebreak(c("Target\nGroup", "Age", "Serum\ntotal calcium\n(mg/dL)"), align = "c"),
             row.names = FALSE,
             escape = FALSE,
             format = "latex") %>%
  kableExtra::kable_styling(latex_options = c("HOLD_position", "striped")) %>%
  kableExtra::collapse_rows(columns = 1, valign = "top") %>%
  kableExtra::row_spec(row = 0, bold = TRUE)
```

We propose to use these normal ranges by age to determine whether a specific respondent group is hypocalcemic or below the normal range for their age or hypercalcemic or above the normal range for their age.

# Iodine

Currently, cut-offs for urinary iodine are available for school-age children and older (6 years and older), pregnant women, and for lactating women and children aged less than 2 years.

Following are the various criteria for assessing iodine status in school-age children and older [@WorldHealthOrganization:2013wl]:

```{r iodine1, echo = FALSE, eval = TRUE}
col1 <- c("< 20", "20 - 49", "50 - 99", "100 - 199", "200 - 299", "≥ 300")
col2 <- c("Insufficient", "Insufficient", "Insufficient", "Adequate", "Above requirements", "Excessive")
col3 <- c("Severe iodine deficiency", 
          "Moderate iodine deficiency", 
          "Mild iodine deficiency", 
          "Adequate iodine nutrition", 
          "May pose a slight risk of more than adequate iodine intake in these populations",
          "Risk of adverse health consequences (iodine-induced hyperthyroidism, autoimmune thyroid disease)")

tab <- data.frame(col1, col2, col3, stringsAsFactors = FALSE)

knitr::kable(x = tab,
             booktabs = TRUE,
             caption = "Epidemiologic criteria for assessing iodine nutrition based on median urinary iodine concentration in school-age children and older",
             col.names = linebreak(c("Median urinary\niodine (µg/L)", "Iodine intake", "Iodine status"), align = "c"),
             row.names = FALSE,
             escape = FALSE,
             format = "latex") %>%
  kableExtra::kable_styling(latex_options = c("HOLD_position", "striped")) %>%
  kableExtra::column_spec(column = 3, width = "8cm") %>%
  kableExtra::row_spec(row = 0, bold = TRUE)
```

Following are the various criteria for assessing iodine status in pregnant women, lactating women and children aged less than 2 years [@WorldHealthOrganization:2013wl]:

```{r iodine2, echo = FALSE, eval = TRUE}
col0 <- c(rep("Pregnant women", 4), 
          rep("Lactating women and children aged less than 2 years", 2))
col1 <- c("< 150", "150 - 249", "250 - 499", "500 or more", "< 100", "100 or more")
col2 <- c("Insufficient", "Adequate", "Above requirements", "Excessive", "Insufficient", "Adequate")

tab <- data.frame(col1, col2, stringsAsFactors = FALSE)

knitr::kable(x = tab,
             booktabs = TRUE,
             caption = "Epidemiologic criteria for assessing iodine nutrition based on median urinary iodine concentration in pregnant women, lactating women, and children aged less than 2 years",
             col.names = linebreak(c("Median urinary iodine (g/L)", 
                                     "Iodine intake"), 
                                   align = "c"),
             row.names = FALSE,
             escape = FALSE,
             format = "latex") %>%
  kableExtra::kable_styling(latex_options = c("HOLD_position", "striped")) %>%
  kableExtra::group_rows(group_label = "Pregnant women",
                         start_row = 1, end_row = 4) %>%
  kableExtra::group_rows(group_label = "Lactating women and children aged less than 2 years",
                         start_row = 5, end_row = 6) %>%
  kableExtra::row_spec(row = 0, bold = TRUE)
```

# Summary

Given these indicator definition, we propose the following list of indicators to be analysed and reported for the Sudan Micronutrient Survey.

```{r indicators, echo = FALSE, eval = TRUE}
Category <- c(rep("Anaemia", 9), 
              rep("Iron deficiency", 3),
              rep("Iron overload", 3),
              rep("Inflammation", 3),
              rep("Calcium deficiency", 3),
              rep("Calcium overload", 3),
              rep("Iodine deficiency", 5),
              rep("Iodine excess", 2))

Indicators <- c("Mild anaemia in children 6-59 months old",
                "Moderate anaemia in children 6-59 months old",
                "Severe anaemia in children 6-59 months old",
                "Mild anaemia in non-pregnant carers",
                "Moderate anaemia in non-pregnant carers",
                "Severe anaemia in non-pregnant carers",
                "Mild anaemia in pregnant carers",
                "Moderate anaemia in pregnant carers",
                "Severe anaemia in pregnant carers",
                "Iron deficiency in children 6-59 months old",
                "Iron deficiency in non-pregnant carers",
                "Iron deficiency in pregnant carers",
                "Iron overload in children 6-59 months old",
                "Iron overload in non-pregnant carers",
                "Iron overload in pregnant carers",
                "Active inflammation in children 6-59 months old",
                "Active inflammation in non-pregnant carers",
                "Active inflammation in pregnant carers",
                "Hypocalcemia in children 12-59 months old",
                "Hypocalcemia in non-pregnant women carers",
                "Hypocalcemia in pregnant carers",
                "Hypercalcemia in children 12-59 months old",
                "Hypercalcemia in non-pregnant women carers",
                "Hypercalcemia in pregnant carers",
                "Mild iodine deficiency in non-pregnant carers",
                "Moderate iodine deficiency in non-pregnant carers",
                "Severe iodine deficiency in non-pregnant carers",
                "Iodine deficiency in pregnant carers",
                "Iodine deficiency in lactating carers",
                "Excessive iodine in non-pregnant carers",
                "Excessive iodine in pregnant carers")

Type <- "Proportion"

tab <- data.frame(Category, Indicators, Type, stringsAsFactors = FALSE)

knitr::kable(x = tab,
             booktabs = TRUE,
             caption = "List of proposed indicators for Sudan National Micronutrient Survey",
             row.names = FALSE,
             format = "latex") %>%
  kableExtra::kable_styling(latex_options = c("HOLD_position", "striped")) %>%
  kableExtra::row_spec(row = 0, bold = TRUE) %>%
  kableExtra::collapse_rows(columns = 1, valign = "top")
```

## Results presentation

Estimates with corresponding confidence intervals for these indicators will be presented in tables. Estimates for these indicators will also be presented as choropleth maps at the state level for which estimates will be representative of.

In addition, we will summarise the biomarker values using the usual 6 figure summary (minimum value, first quantile, median, mean, third quartile and maximum value) and then present the distribution of the biomarker values as a violin plot with the range of normal values shown. An example violin plot for Hb is shown below.

```{r violin, echo = FALSE, eval = TRUE, fig.cap = "Example violin plot for Hb in children 6-59 months sample by state", fig.width = 16, fig.height = 10, fig.align = "center", fig.pos = "H"}
## Subest to Hb only
hbData <- subset(mnData2, select = c(state, m.age, ch.age, sex, group, hb))

## Subset to children only
hbData <- subset(hbData, group == "Child")

hbData$state <- factor(hbData$state)
hbData$hb <- as.numeric(hbData$hb)

## Convert to long
#mnData_long <- tidyr::pivot_longer(mnData2, cols = hb, names_to = )

ggplot(data = hbData, mapping = aes(x = state, y = hb)) +
  geom_violin(trim = TRUE) +
  #geom_jitter(shape = 20, position = position_jitter(0.05)) +
  geom_boxplot(width = 0.2) +
  geom_hline(yintercept = 11, colour = "darkgreen", linetype = 2) + 
  geom_hline(yintercept = 10, colour = "orange", linetype = 2) +
  geom_hline(yintercept = 7, colour = "red", linetype = 2) +
  themeSettings
```


\newpage

# References
